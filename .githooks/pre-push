#!/usr/bin/env bash
# Pre-push hook â€” run tests, check lock files.
# Install with: make install

set -e

echo "ğŸ” Running pre-push checks..."

echo ""
echo "ğŸ“¦ Checking lock files..."
(cd backend && poetry check --lock)
(cd scraper && poetry check --lock)
(cd core && poetry check --lock)
(cd bot && poetry check --lock)

echo ""
echo "ğŸ—„ï¸  Checking migration coverage..."
if git diff main --name-only | grep -q 'core/db/models\.py' && \
   ! git diff main --name-only | grep -q 'core/alembic/versions/'; then
  echo "âŒ Model changes detected without a migration revision!"
  echo "   Run: make revision msg=\"description\""
  exit 1
fi

echo ""
make test

echo ""
echo "âœ… All checks passed â€” pushing."
